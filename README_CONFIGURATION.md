# Configuration Management for Quantive App

This document explains how configuration management works for the Quantive app across different environments.

## ğŸ” Security First Approach

Our configuration system uses GitHub Secrets for production environments, keeping sensitive credentials out of the repository.

## ğŸ“ Configuration Files Structure

### Files in Repository
- `config/development.json` - âœ… Safe to commit (local development only)
- `config/template.json` - âœ… Template structure (no real keys)
- `scripts/` - Setup scripts for local development

### Generated Files (not in repository)
- `config/generated-config.json` - Generated by CI/CD with injected secrets
- `composeApp/src/androidMain/assets/app-config.json` - Final app configuration

## ğŸš€ Environment Setup

### Local Development
```bash
# Setup script (Windows)
scripts\setup-local-config.bat

# Setup script (Unix/Linux/macOS)
./scripts/setup-local-config.sh

# Or manually:
cp config/development.json composeApp/src/androidMain/assets/app-config.json
```

### CI/CD Environments
The workflow automatically injects secrets from GitHub Secrets:

**Required GitHub Secrets:**
- `SUPABASE_URL` - Your Supabase project URL
- `SUPABASE_ANON_KEY` - Anonymous/public key
- `SUPABASE_SERVICE_ROLE_KEY` - Service role key
- `SUPABASE_JWT_SECRET` - JWT secret

## ğŸ”§ Build Commands

### Local Development
```bash
# Development (uses local config)
./gradlew assembleDebug
```

### CI/CD (GitHub Actions)
```bash
# Trigger workflow manually
gh workflow run build-with-secrets.yml -f environment=staging
gh workflow run build-with-secrets.yml -f environment=production

# Automatic on push to main/develop
# Environment determined by branch
```

## ğŸ“‹ Environment Variables in Builds

### Development
- Uses `config/development.json`
- No secrets needed
- Points to your local Supabase instance

### Staging
- Uses injected secrets from GitHub
- Points to staging Supabase project
- Build type: `assembleStaging`

### Production
- Uses injected secrets from GitHub
- Points to production Supabase project
- Build type: `assembleRelease`

## ğŸ”’ Security Best Practices

### âœ… What We Do Right
- **No production secrets in git**
- **GitHub Secrets for CI/CD**
- **Template files for structure**
- **Environment-specific builds**

### ğŸ”§ How It Works

1. **Local Development**: Uses safe development config
2. **CI/CD Build**: GitHub Actions injects secrets into temporary config
3. **Build Process**: Config is embedded in APK at build time
4. **Runtime**: App reads config from bundled assets

## ğŸš¨ Important Security Notes

### âœ… Safe to Commit
- `config/development.json` (contains only local dev keys)
- `config/template.json` (contains only placeholders)
- Configuration structure and templates

### âŒ Never Commit
- Production/staging actual keys
- Real service role keys
- Real JWT secrets

### ğŸ”„ When Secrets Change
1. Update GitHub Secrets in repository settings
2. Trigger new build
3. New APK will have updated secrets

## ğŸ› ï¸ Adding New Environments

1. Add environment enum in `Environment.kt`
2. Add build variant in `build.gradle.kts`
3. Update workflow dispatch options
4. Add GitHub Secrets for the new environment

## ğŸ› Troubleshooting

### Build Failures
```bash
# Check if config file exists
ls -la composeApp/src/androidMain/assets/app-config.json

# Re-create local config
./scripts/setup-local-config.sh
```

### Secret Injection Issues
1. Verify GitHub Secrets are set correctly
2. Check workflow runs show secrets are loaded
3. Validate generated config before build

### Runtime Issues
1. Check app's config display (if implemented)
2. Verify Supabase URL matches expected environment
3. Test API calls with appropriate keys